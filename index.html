<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Play Store SSO &amp; Reviews Management</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    input, button, textarea { padding: 8px; font-size: 1rem; margin: 4px 0; }
    button { cursor: pointer; }
    .review { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .reviews-container { max-height: 400px; overflow-y: auto; background: #f9f9f9; padding: 10px; }
  </style>
</head>
<body>
  <h2>Google Play Store Reviews Manager</h2>
  <button id="signin-btn">Sign In with Google</button>
  <button id="signout-btn" class="hidden">Sign Out</button>
  <div id="auth-info" class="hidden"></div>
  <div id="app-section" class="hidden">
    <label for="pkg">Package Name:</label><br>
    <input type="text" id="pkg" placeholder="e.g., com.example.myapp" style="width: 300px;"><br>
    <button id="fetchBtn">Fetch Reviews</button>
  </div>
  <div id="reviews" class="reviews-container hidden"></div>

  <script>
    const CLIENT_ID = 'YOUR_CLIENT_ID.apps.googleusercontent.com';
    const API_DISCOVERY_DOC = 'https://androidpublisher.googleapis.com/$discovery/rest?version=v3';
    const SCOPES = 'https://www.googleapis.com/auth/androidpublisher';

    let GoogleAuth;

    function initClient() {
      gapi.client.init({
        discoveryDocs: [API_DISCOVERY_DOC],
        clientId: CLIENT_ID,
        scope: SCOPES
      }).then(() => {
        GoogleAuth = gapi.auth2.getAuthInstance();
        GoogleAuth.isSignedIn.listen(updateSigninStatus);
        document.getElementById('signin-btn').onclick = () => GoogleAuth.signIn({prompt: 'select_account'});
        document.getElementById('signout-btn').onclick = () => GoogleAuth.signOut();
        updateSigninStatus(GoogleAuth.isSignedIn.get());
      });
    }

    function updateSigninStatus(isSignedIn) {
      document.getElementById('signin-btn').classList.toggle('hidden', isSignedIn);
      document.getElementById('signout-btn').classList.toggle('hidden', !isSignedIn);
      document.getElementById('app-section').classList.toggle('hidden', !isSignedIn);
      document.getElementById('reviews').classList.add('hidden');
      if (isSignedIn) {
        const user = GoogleAuth.currentUser.get().getBasicProfile();
        document.getElementById('auth-info').textContent = `Signed in as ${user.getEmail()}`;
        document.getElementById('auth-info').classList.remove('hidden');
      } else {
        document.getElementById('auth-info').classList.add('hidden');
      }
    }

    document.getElementById('fetchBtn').onclick = async () => {
      const pkg = document.getElementById('pkg').value.trim();
      if (!pkg) return alert('Enter a package name');
      const reviewsContainer = document.getElementById('reviews');
      reviewsContainer.innerHTML = 'Loading...';
      reviewsContainer.classList.remove('hidden');
      try {
        const resp = await gapi.client.androidpublisher.reviews.list({packageName: pkg});
        const reviews = resp.result.reviews || [];
        reviewsContainer.innerHTML = '';
        reviews.forEach(r => {
          const div = document.createElement('div');
          div.className = 'review';
          const comment = r.comments[0].userComment;
          div.innerHTML = `
            <strong>Review by ${comment.authorName}</strong> (Rating: ${comment.starRating})<br>
            ${comment.text}<br>
            <textarea rows="2" cols="60" placeholder="Your reply..."></textarea><br>
            <button class="reply-btn" data-review-id="${r.reviewId}">Reply</button>
          `;
          reviewsContainer.appendChild(div);
        });
        document.querySelectorAll('.reply-btn').forEach(btn => {
          btn.onclick = async () => {
            const reviewId = btn.getAttribute('data-review-id');
            const textarea = btn.previousElementSibling;
            const replyText = textarea.value.trim();
            if (!replyText) return alert('Enter a reply');
            await gapi.client.androidpublisher.reviews.reply({
              packageName: pkg,
              reviewId: reviewId,
              resource: {replyText}
            });
            alert('Replied to ' + reviewId);
          };
        });
      } catch (e) {
        reviewsContainer.innerHTML = 'Error: ' + e.message;
      }
    };

    gapi.load('client:auth2', initClient);
  </script>
</body>
</html>

